#!/usr/bin/env node

'use strict';

const cp = require('child_process');
const prettier = require('prettier');
const type = process.argv[2];

function beautify(content) {
  switch (type) {
    case 'javascript':
    case 'json':
      content = prettier.format(content, {
        singleQuote: true,
        trailingComma: 'es5',
      });
      break;
  }

  process.stdout.write(content);
}

if (type === 'java') {
  cp.spawn(
    'uncrustify',
    ['-c', '/usr/local/etc/uncrustify.cfg', '-l', 'java', '-q'],
    {
      stdio: 'inherit',
    }
  );
} else {
  let result = [];

  process.stdin.on('data', function(chunk) {
    result.push(chunk);
  });
  process.stdin.on('end', function() {
    result = Buffer.concat(result);
    beautify(result.toString());
  });
}
