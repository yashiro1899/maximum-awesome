#!/usr/bin/env node

'use strict';
var type = process.argv[2];
var result = [];

function beautify(content) {
  switch (type) {
  case 'css':
    content = require("js-beautify")
      .css(content);
    break;
  case 'javascript':
  case 'json':
    content = require("js-beautify")(content, {
      indent_size: 2,
      keep_array_indentation: true,
      space_after_anon_function: false
    });
    break;
  }

  process.stdout.write(content);
}

if (type === "java") {
  require('child_process')
    .spawn('uncrustify', [
            '-c',
            '/usr/local/etc/uncrustify.cfg',
            '-l',
            'java',
            '-q'
        ], {
      stdio: 'inherit'
    });
} else {
  process.stdin.on('data', function (chunk) {
    result.push(chunk);
  });
  process.stdin.on('end', function () {
    result = Buffer.concat(result);
    beautify(result.toString());
  });
}
