#!/bin/bash

HOSTSFILE="/etc/hosts"
FILESPATH="$HOME/.hosts"
files=$(find $FILESPATH -type f -maxdepth 1 2> /dev/null)

for h in $files; do
    cmp $HOSTSFILE $h &> /dev/null
    if [ $? -eq 0 ]; then
        current=${h##*/}
        echo "Current: [ $current ]"
        echo
        break
    fi
done
# grep -E "^# this is beta" $HOSTSFILE &> /dev/null
# if [ $? -eq 0 ]; then
#     current="beta"
#     ip=$(tail -n 2 $HOSTSFILE | sed -e "/^#/d" -e "s/ .*$//")
#     echo "Current: [ $current($ip) ]"
#     echo
# fi


cphosts() {
    sudo cp $1 $HOSTSFILE

    echo "Changed \"$HOSTSFILE\" to [ ${1##*/} ]"
    echo
    cat -n $HOSTSFILE
}

i=0
for h in $files; do
    (( i++ ))
    if [ "$1" = "$i" ]; then
        cphosts $h
        exit 0
    fi
done

select h in ${files//$FILESPATH\//}; do
    if [ -z "$h" ]; then break; fi

    list="$FILESPATH/${h}_list"
    if [ -d $list ]; then
        cd $list
        select i in *; do
#         beta="$FILESPATH/beta"
#         select i in $(grep -E "^# \d{1,3}\." $beta | cut -c 3-); do
#             sudo sh -c "sed -e '/te\.hotel/,$ d' $beta > $HOSTSFILE"
#             sudo sh -c "echo '$i  te.hotel.qunar.com hotel.qunar.com bnb.qunar.com' >> $HOSTSFILE"
#             sudo sh -c "echo '# this is beta' >> $HOSTSFILE"

#             echo -ne "\n"
#             echo "Changed \"$HOSTSFILE\" to [ beta ]"
#             echo
#             cat -n $HOSTSFILE
            echo $i
            break
        done
        break
    fi

    if [ "$current" = "$h" ]; then break; fi
    echo -ne "\n"
    cphosts $h
    break
done
