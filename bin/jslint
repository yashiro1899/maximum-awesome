#!/bin/bash

JSL=$(which jsl)
PARAM="-conf $HOME/.bin/jsl.conf -nologo -nofilelisting -nosummary -nocontext"
if [ "$1" = '-stdin' ]; then
    "$JSL" $PARAM $1
else
    files=""
    until [ -z "$1" ]; do
        files="$files -process $1"
        shift
    done
    result=$("$JSL" $PARAM $files)

    IFS=$'\n'
    for line in $result; do
        if [ -z "$path" ] || [ "$path" != "${line%%(*}" ]; then
            path=${line%%(*}
            rel=$(node -p "require('path').relative(process.cwd(), '$path')")
        fi

        echo "$rel(${line#*(}"
    done
fi
