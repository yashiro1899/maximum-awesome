#!/bin/bash
function shorten() {
    c=1
    f=$(echo $1 | cut -c $c"-")

    while [ -n "$f" ]; do
        (( c++ ))
        f=$(echo $1 | cut -c $c"-")
        if [ -f "$f" ]; then
            echo -n $f
            return 0
        fi
    done
    echo -n $1
    return 1
}

JSL=$(which jsl)
PARAM="-conf $HOME/.bin/jsl.conf -nologo -nofilelisting -nosummary -nocontext"
if [ $1 = '-stdin' ]; then
    $JSL $PARAM $1
else
    files=""
    until [ -z "$1" ]; do
        files="$files -process $1"
        shift
    done

    out=$($JSL $PARAM $files)
    IFS=$'\n'
    for line in $out; do
        if [ -z "$path" ]; then
            path=${line%%(*}
            short=$(shorten $path)
        elif [ "$path" != "${line%%(*}" ]; then
            path=${line%%(*}
            short=$(shorten $path)
        fi
        other="(${line#*(}"
        echo $short$other
    done
fi
