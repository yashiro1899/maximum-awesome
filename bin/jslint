#!/bin/bash

JSL=$(which jsl)
PARAM="-conf $HOME/bin/jsl.conf -nologo -nofilelisting -nosummary -nocontext"
if [ "$1" = '-stdin' ]; then
    "$JSL" $PARAM $1
else
    files=""
    until [ -z "$1" ]; do
        files="$files -process $1"
        shift
    done
    result=$("$JSL" $PARAM $files)

    IFS=$'\n'
    for line in $result; do
        if [ -z "$path" ]; then
            path=${line%%(*}
        elif [ "$path" != "${line%%(*}" ]; then
            path=${line%%(*}
        fi

        current=$(pwd -W)
        other="(${line#*(}"

        echo $(realpath --relative-to="$current" "$path")$other
    done
fi
